#### Основными микросервисами, отвечающими за реализацию бизнес-логики, станут:

1. Menu Service
2. Orders Service
3. Review Service
4. Menu Aggregate Service
5. Order Dispatch Service

# Menu Service
**Предоставляет REST API для CRUD-операций с меню:**

- _POST /v1/menu-items_ - создать блюдо, информация о блюде передается в теле запроса. Доступно для сотрудников, информация о сотруднике передается в токене доступа.
- _DELETE /v1/menu-items/{id}_ - удалить блюдо. Доступно для сотрудников, информация о сотруднике передается в токене доступа
- _PATCH /v1/menu-items/{id}_ - обновить блюдо, параметры обновления передаются в теле запроса. Доступно для сотрудников, информация о сотруднике передается в токене доступа
- _GET /v1/menu-items/{id}_ - получить блюдо. Доступно всем пользователям
- _GET /v1/menu-items?category={category}&sort={sort}_ - получить список блюд из выбранной категории, отсортированный или по алфавиту (AZ, ZA), или по цене (PRICE_ASC, PRICE_DESC), или по дате создания (DATE_ASC, DATE_DESC). Доступно всем пользователям
`Данные хранятся в реляционной базе PostgreSQL 16.`

# Orders Service
**Предоставляет REST API для создания и просмотра совершенных пользователем заказов:**

- _POST /v1/menu-orders_ - создать заказ, информация о заказе передается в теле запроса. Доступно для зарегистрированных клиентов онлайн кафе, информация о пользователе передается в токене доступа
- _GET /v1/menu-orders?sort={sort}&from={from}&size={size}_ - получить пагинированный список (используется offset пагинация) заказов пользователя, отсортированный по дате создания (DATE_ASC, DATE_DESC). Информация о пользователе передается в токене доступа.

Отправляет в топик Kafka `v1.public.orders_outbox` сообщения о создании заказа после того, как заказ был сохранен. Для обеспечения гарантированной отправки сообщения применяется [паттерн Transactional Outbox](https://microservices.io/patterns/data/transactional-outbox.html), для чего используется [Kafka Connect](https://docs.confluent.io/platform/current/connect/index.html) (система, позволяющая надежно вычитывать данные из внешних систем в Kafka и отправлять данные из топиков Kafka во внешние системы) и [Debezium Postgres Connector](https://debezium.io/documentation/reference/stable/connectors/postgresql.html) (опенсорсный коннектор, который постоянно вычитывает изменения в БД и отправляет их в топики Kafka). Вычитывает из топика Kafka `v1.orders_dispatch` сообщения о том, что заказ был обработан и передан на исполнение или отклонен, обновляет статус заказа в Postgres.  
Дополнительно: [Kafka Connect на примере Debezium PostgresConnector](https://habr.com/ru/articles/779620/).

`Данные хранятся в реляционной базе PostgreSQL 16.`

# Review Service
**Предоставляет REST API для CRUD-операций с отзывами пользователей о блюдах:**

- _POST /v1/reviews_ - создать отзыв, информация об отзыве передается в теле запроса. Информация о пользователе, создающем отзыв, передается в токене доступа, доступно для зарегистрированных пользователей. Рейтинг блюда должен быть от 1 до 5.
- _GET /v1/reviews/{id}_ - получить отзыв по ID. Доступно всем пользователям
- _GET /v1/reviews/my?sortBy={sort}&from={from}&size={size}_ получить пагинированный список отзывов конкретного пользователя. Список отсортирован по дате создания: DATE_ASC, DATE_DESC. Информация о пользователе передается в токене доступа. (доступно для зарегистрированных пользователей)
- _GET /v1/reviews/menu-items/{id}?sort={sort}&from={from}&size={size}_ - получить пагинированный список отзывов к конкретному блюду. Список отсортирован по дате создания: DATE_ASC, DATE_DESC. Доступно всем пользователям. Также в ответе передается информация о рейтинге и средней оценке блюда.
- _POST /v1/reviews/ratings_ - получить рейтинги и средние оценки блюд, идентификаторы которых передаются в теле запроса. Рейтинг блюда рассчитывается согласно доверительному интервалу биномиального распределения по методу Уилсона (Wilson Score Confidence Interval).
`Данные хранятся в реляционной базе PostgreSQL 16.`

# Menu Aggregate Service
**Предоставляет REST API для агрегированных запросов блюд с отзывами или с рейтингами:**

- _GET /v1/menu-aggregate/{menuId}?sort={sort}&from={from}&size={size}_ - получить информацию о блюде с отзывами. Список отзывов пагинирован и отсортирован по дате создания: DATE_ASC, DATE_DESC.
- _GET /v1/menu-aggregate?category={category}&sort={sort}_ - получить информацию о блюдах из указанной категории. Блюда отсортированы или по алфавиту (AZ, ZA), или по цене (PRICE_ASC, PRICE_DESC), или по дате создания (DATE_ASC, DATE_DESC), или по рейтингу (RATE_ASC, RATE_DESC). Информация по каждому блюду включает в себя рейтинг блюда, полученный из _Review Service_.

`Не хранит данные в базе, а получает их из сервисов _Menu Service_ и _Orders Service_ с помощью неблокирующих вызовов, используя Spring WebFlux.`

# Order Dispatch Service
**Реализует обработку заказов**

- Вычитывает из топика Kafka `v1.public.orders_outbox` сообщения о создании заказа, далее происходит обработка заказа. На текущий момент логика заключается в логировании события.
- После обработки заказа отправляет в топик Kafka `v1.orders_dispatch` сообщение об обработке заказа, содержащее статус заказа после обработки.

